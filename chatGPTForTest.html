<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ANOVA 計算器</title>
    <script>
        function calculateANOVA(groups) {
            const groupSizes = groups.map(group => group.length);
            const totalSamples = groupSizes.reduce((acc, size) => acc + size, 0);
            const grandMean = groups.reduce((acc, group) => acc + group.reduce((sum, value) => sum + value, 0), 0) / totalSamples;
            const sst = groups.reduce((acc, group) => acc + group.reduce((sum, value) => sum + Math.pow(value - grandMean, 2), 0), 0);
            const ssw = groups.reduce((acc, group, index) => {
                const groupMean = group.reduce((sum, value) => sum + value, 0) / groupSizes[index];
                return acc + group.reduce((sum, value) => sum + Math.pow(value - groupMean, 2), 0);
            }, 0);
            const ssb = groups.reduce((acc, group, index) => {
                const groupMean = group.reduce((sum, value) => sum + value, 0) / groupSizes[index];
                return acc + group.length * Math.pow(groupMean - grandMean, 2);
            }, 0);
            const dfBetween = groups.length - 1;
            const dfWithin = totalSamples - groups.length;
            const msb = ssb / dfBetween;
            const msw = ssw / dfWithin;
            const fValue = msb / msw;
            return {
                dfBetween: dfBetween,
                dfWithin: dfWithin,
                ssb: ssb,
                ssw: ssw,
                sst: sst,
                msb: msb,
                msw: msw,
                fValue: fValue
            };
        }

        function runANOVA() {
            const group1 = document.getElementById('group1').value.split(',').map(Number);
            const group2 = document.getElementById('group2').value.split(',').map(Number);
            const group3 = document.getElementById('group3').value.split(',').map(Number);

            const result = calculateANOVA([group1, group2, group3]);

            document.getElementById('dfBetween').innerText = result.dfBetween;
            document.getElementById('dfWithin').innerText = result.dfWithin;
            document.getElementById('ssb').innerText = result.ssb.toFixed(2);
            document.getElementById('ssw').innerText = result.ssw.toFixed(2);
            document.getElementById('sst').innerText = result.sst.toFixed(2);
            document.getElementById('msb').innerText = result.msb.toFixed(2);
            document.getElementById('msw').innerText = result.msw.toFixed(2);
            document.getElementById('fValue').innerText = result.fValue.toFixed(2);
        }
    </script>
</head>
<body>
    <h1>ANOVA 計算器</h1>
    <div>
        <label for="group1">組別1數據 (以逗號分隔):</label>
        <input type="text" id="group1" value="10,12,13,14,15"><br>
        <label for="group2">組別2數據 (以逗號分隔):</label>
        <input type="text" id="group2" value="8,9,11,12,14"><br>
        <label for="group3">組別3數據 (以逗號分隔):</label>
        <input type="text" id="group3" value="7,8,9,10,11"><br>
        <button onclick="runANOVA()">計算ANOVA</button>
    </div>
    <h2>ANOVA 結果</h2>
    <table border="1">
        <tr>
            <th></th>
            <th>自由度</th>
            <th>平方和</th>
            <th>均方</th>
            <th>F 值</th>
        </tr>
        <tr>
            <td>組間</td>
            <td id="dfBetween"></td>
            <td id="ssb"></td>
            <td id="msb"></td>
            <td id="fValue" rowspan="2"></td>
        </tr>
        <tr>
            <td>組內</td>
            <td id="dfWithin"></td>
            <td id="ssw"></td>
            <td id="msw"></td>
        </tr>
        <tr>
            <td>總和</td>
            <td id="totalDF"></td>
            <td id="sst"></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</body>
</html>
