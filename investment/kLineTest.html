<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>00675L 日k線圖</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
  </head>
  <body>
    <div id="chart"></div>
    <script src="kline.js"></script>
    <img src="../assets/testAssets/00675L.TW.csv">
  </body>
  <script>
    // 設定圖表的寬度、高度和邊距
    const margin = { top: 20, right: 30, bottom: 30, left: 50 };
    const width = 1280 - margin.left - margin.right;
    const height = 500 - margin.top - margin.bottom;

    // 創建SVG元素
    const svg = d3.select("#chart")
                  .append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", `translate(${margin.left},${margin.top})`);

    // 設定時間尺度和價格尺度
    const x = d3.scaleTime().range([0, width]);
    const y = d3.scaleLinear().range([height, 0]);

    // 設定K線圖的顏色
    const color = d => d.Close > d.Open ? "red" : "green";

    // 讀取CSV文件並處理數據
    d3.csv("../assets/testAssets/00675L.TW.csv").then(data => {
        data.forEach(d => {
            d.Date = d3.timeParse("%Y-%m-%d")(d.Date);
            d.Open = +d.Open;
            d.High = +d.High;
            d.Low = +d.Low;
            d.Close = +d.Close;
        });
      
        x.domain(d3.extent(data, d => d.Date));
        y.domain([d3.min(data, d => d.Low), d3.max(data, d => d.High)]);
      
        // 添加X軸
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x));
      
        // 添加Y軸
        svg.append("g")
            .call(d3.axisLeft(y));
      
        // 添加K線圖
        svg.selectAll("line.stem")
            .data(data)
            .enter().append("line")
            .attr("class", "stem")
            .attr("x1", d => x(d.Date))
            .attr("x2", d => x(d.Date))
            .attr("y1", d => y(d.High))
            .attr("y2", d => y(d.Low))
            .attr("stroke", color);
      
        svg.selectAll("rect")
            .data(data)
            .enter().append("rect")
            .attr("x", d => x(d.Date) - 3)
            .attr("y", d => y(Math.max(d.Open, d.Close)))
            .attr("width", 4)
            .attr("height", d => Math.abs(y(d.Open) - y(d.Close)))
            .attr("fill", color);
    });

  </script>
  
</html>
