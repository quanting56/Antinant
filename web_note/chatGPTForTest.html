<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>00675L 日k線圖</title>
    <script src="https://d3js.org/d3.v6.min.js"></script>
  </head>
  <body>
    <div id="chart"></div>
    <script src="kline.js"></script>
    <img src="../assets/testAssets/00675L.TW.csv">
  </body>
  <script>
    // 設定圖表的寬度、高度和邊距
    const margin = { top: 20, right: 30, bottom: 30, left: 50 };
    const width = 960 - margin.left - margin.right;
    const height = 500 - margin.top - margin.bottom;

    // 創建SVG元素
    const svg = d3.select("#chart")
                  .append("svg")
                  .attr("width", width + margin.left + margin.right)
                  .attr("height", height + margin.top + margin.bottom)
                  .append("g")
                  .attr("transform", `translate(${margin.left},${margin.top})`);

    // 設定時間尺度和價格尺度
    const x = d3.scaleTime().range([0, width]);
    const y = d3.scaleLinear().range([height, 0]);

    // 設定K線圖的顏色
    const color = d => d.close > d.open ? "red" : "green";

    // 讀取CSV文件並處理數據
    d3.csv("../assets/testAssets/00675L.TW.csv").then(data => {
        data.forEach(d => {
            d.date = d3.timeParse("%Y/%m/%d")(d.date);
            d.open = +d.open;
            d.high = +d.high;
            d.low = +d.low;
            d.close = +d.close;
        });
      
        x.domain(d3.extent(data, d => d.date));
        y.domain([d3.min(data, d => d.low), d3.max(data, d => d.high)]);
      
        // 添加X軸
        svg.append("g")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x));
      
        // 添加Y軸
        svg.append("g")
            .call(d3.axisLeft(y));
      
        // 添加K線圖
        svg.selectAll("line.stem")
            .data(data)
            .enter().append("line")
            .attr("class", "stem")
            .attr("x1", d => x(d.date))
            .attr("x2", d => x(d.date))
            .attr("y1", d => y(d.high))
            .attr("y2", d => y(d.low))
            .attr("stroke", color);
      
        svg.selectAll("rect")
            .data(data)
            .enter().append("rect")
            .attr("x", d => x(d.date) - 5)
            .attr("y", d => y(Math.max(d.open, d.close)))
            .attr("width", 5)
            .attr("height", d => Math.abs(y(d.open) - y(d.close)))
            .attr("fill", color);
    });

  </script>
</html>
